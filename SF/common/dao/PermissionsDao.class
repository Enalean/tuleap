<?php
//
// Copyright (c) Xerox Corporation, CodeX Team, 2001-2005. All rights reserved
//
// $Id$
//

require_once('include/DataAccessObject.class');

/**
 *  Data Access Object for Permissions 
 */
class PermissionsDao extends DataAccessObject {
    /**
    * Constructs the PermissionsDao
    * @param $da instance of the DataAccess class
    */
    function PermissionsDao( & $da ) {
        DataAccessObject::DataAccessObject($da);
    }
    
    /**
    * Gets all tables of the db
    * @return DataAccessResult
    */
    function & searchAll() {
        $sql = "SELECT * FROM permissions";
        return $this->retrieve($sql);
    }
    
    /**
    * Searches Permissions by PermissionType 
    * @return DataAccessResult
    */
    function & searchByPermissionType($permissionType) {
        $sql = sprintf("SELECT object_id, ugroup_id FROM permissions WHERE permission_type = %s",
				"'".$permissionType."'");
        return $this->retrieve($sql);
    }

    /**
    * Searches Permissions by ObjectId 
    * @return DataAccessResult
    */
    function & searchByObjectId($objectId) {
        $sql = sprintf("SELECT permission_type, ugroup_id FROM permissions WHERE object_id = %s",
				"'".$objectId."'");
        return $this->retrieve($sql);
    }

    /**
    * Searches Permissions by UgroupId 
    * @return DataAccessResult
    */
    function & searchByUgroupId($ugroupId) {
        $sql = sprintf("SELECT permission_type, object_id FROM permissions WHERE ugroup_id = %s",
				"'".$ugroupId."'");
        return $this->retrieve($sql);
    }

    /**
    * Searches Permissions by ObjectId and Ugroups
    * @return DataAccessResult
    */
    function & searchPermissionsByObjectIdAndUgroups($objectId, $ugroups) {
        $sql = sprintf("SELECT * FROM permissions WHERE object_id = %s AND ugroup_id IN (%s)" ,
				$objectId,
                implode(', ', $ugroups));
        return $this->retrieve($sql);
    }

    /**
    * Searches Permissions by TrackerId and Ugroups
    * @return DataAccessResult
    */
    function & searchPermissionsByArtifactFieldIdAndUgroups($objectId, $ugroups) {
        $sql = sprintf("SELECT * FROM permissions WHERE (object_id = %s OR object_id LIKE '%s#%%') AND ugroup_id IN (%s)" ,
				$objectId,
				$objectId,
                implode(', ', $ugroups));
        return $this->retrieve($sql);
    }

}


?>