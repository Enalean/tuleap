<form name="newCampaignForm" ng-submit="createCampaign(campaign)">
    <div id="campaign-new-container">
        <h1 translate>Create a campaign</h1>

        <label translate>Campaign label</label>
        <input type="text" ng-model="campaign.label" required="required" ng-trim auto-focus />

        <tabset>
            <tab
                ng-repeat="environment in campaign.environments | filter:{is_choosen:true}"
                heading="{{ environment.label }}"
            >
                <div class="row-fluid">
                    <div class="span6">
                        <input type="text" placeholder="{{ 'Filter...' | translate }}" ng-model="environment.filter" ng-trim>
                    </div>

                    <div class="span6 loading-definitions">
                        <img src="scripts/angular/bin/assets/loader.gif" ng-show="loading_definitions" />
                        <span
                            translate
                            translate-n="getFilteredDefinitions(environment.filter).length"
                            translate-plural="<span class='total-definitions'>{{ getFilteredDefinitions(environment.filter).length }}</span> tests">
                                <span class='total-definitions'>{{ getFilteredDefinitions(environment.filter).length }}</span> test
                        </span>
                    </div>
                </div>
                <div class="row-fluid">
                    <div class="span12">
                        <table class="table table-striped table-bordered test-definition-list">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" ng-model="environment.select_all" ng-change="selectAll(environment, ITEMS_PER_PAGE)" /></th>
                                    <th>#</th>
                                    <th translate>Test name</th>
                                    <th translate>Category</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-if="environment.select_all && (environment.nb_selected_all > ITEMS_PER_PAGE || environment.nb_selected_all !== environment.nb_selected_all_total)">
                                    <td colspan="4" class="selected-all">
                                        <span ng-if="environment.nb_selected_all === environment.nb_selected_all_total" translate>All <strong>{{ environment.nb_selected_all }}</strong> tests are selected.</span>
                                        <span ng-if="environment.nb_selected_all !== environment.nb_selected_all_total">
                                            <span ng-if="environment.page_selected_all === environment.current_page" translate>All <strong>{{ environment.nb_selected_all }}</strong> tests on this page are selected.</span>
                                            <span ng-if="environment.page_selected_all !== environment.current_page" translate>No tests on this page are selected.</span>
                                            <a ng-click="selectAllTotal(environment)" translate>Select all <strong>{{ environment.nb_selected_all_total }}</strong> tests.</a>
                                        </span>
                                    </td>
                                </tr>
                                <tr ng-repeat="definition in getFilteredDefinitions(environment.filter)
                                    | orderBy:'id'
                                    | unique: 'id'
                                    | CurrentPageFilter:environment.current_page:ITEMS_PER_PAGE
                                    track by $index"
                                >
                                    <td><input type="checkbox" ng-model="environment.definitions[definition.id]" ng-click="selectADefinitionForEnvironment(environment)" /></td>
                                    <td>{{ definition.id }}</td>
                                    <td>{{ definition.summary }}</td>
                                    <td>{{ definition.category }}</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="definitions-pagination-container">
                            <pagination
                                total-items="getFilteredDefinitions(environment.filter).length"
                                items-per-page="{{ ITEMS_PER_PAGE }}"
                                max-size="5"
                                page="environment.current_page"
                                class="pagination-sm"
                                boundary-links="true"
                                previous-text="&lsaquo;"
                                next-text="&rsaquo;"
                                first-text="&laquo;"
                                last-text="&raquo;"
                            ></pagination>
                        </div>
                    </div>
                </div>
            </tab>
            <tab>
                <tab-heading>
                    <i class="icon icon-plus"></i>
                </tab-heading>
                <p translate>Tests are run in an environment.</p>
                <p ng-if="! campaign.label" translate>Please choose the environments for the new campaign:</p>
                <p ng-if="campaign.label" translate>Please choose the environments for "{{ campaign.label }}" campaign:</p>

                <label ng-repeat="environment in campaign.environments" class="checkbox">
                    <input type="checkbox" ng-model="environment.is_choosen" />
                    {{ environment.label }}
                </label>

                <img src="scripts/angular/bin/assets/loader.gif"
                     ng-if="loading_environments"
                     class="loader" />

                <div class="alert alert-error error-no-environment-defined"
                     ng-if="! campaign.environments.length && ! loading_environments">
                    <img src="scripts/angular/bin/assets/sad-cat.jpg" alt="sad cat is sad" />
                    <p>
                        <strong translate>Oh no!</strong>
                        <span translate>You have not any environment defined.</span>
                    </p>
                    <p>
                        <span translate>Please configure the test execution tracker and
                        add environments in order to be able to go further.</span>
                    </p>
                </div>
            </tab>
        </tabset>
    </div>

    <div id="campaign-new-button-bar">
        <button
            type="submit"
            class="btn btn-large btn-primary"
            ng-disabled="submitting_campaign || ! newCampaignForm.$valid">
            <i class="icon-spinner icon-spin" ng-if="submitting_campaign"></i>
            <span translate>Create campaign</span>
        </button>
    </div>
</form>